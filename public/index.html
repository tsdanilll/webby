<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>To-do list</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
  </head>
  <body>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <div id="root"></div>
    <script type="module">
      import React, { useEffect, useState } from "https://cdn.skypack.dev/react";
      import { createRoot } from "https://cdn.skypack.dev/react-dom/client";

      const API_URL = "https://4lugw2l2ooxz2c6po5ytwycmru0myjsx.lambda-url.us-east-1.on.aws/";

      function TaskList({ tasks }) {
        if (!tasks || tasks.length === 0) {
          return (
            <span style={{ color: "#888", textAlign: "center" }}>
              No tasks yet.
            </span>
          );
        }
        return (
          <ul style={{ listStyle: "none", padding: 0, margin: 0 }}>
            {tasks.map((task) => (
              <li
                key={task.id}
                style={{
                  display: "flex",
                  alignItems: "center",
                  justifyContent: "space-between",
                  padding: "8px 0",
                  borderBottom: "1px solid #e0e0e0",
                  opacity: task.is_done ? 0.6 : 1,
                  textDecoration: task.is_done ? "line-through" : "none",
                  wordBreak: "break-word"
                }}
              >
                <span style={{ flex: 1 }}>{task.title}</span>
              </li>
            ))}
          </ul>
        );
      }

      function App() {
        const [tasks, setTasks] = useState([]);
        const [loading, setLoading] = useState(true);

        useEffect(() => {
          async function fetchTasks() {
            setLoading(true);
            try {
              const res = await fetch(API_URL);
              const data = await res.json();
              setTasks(data);
            } catch (err) {
              setTasks([]);
              console.error("Failed to fetch tasks:", err);
            } finally {
              setLoading(false);
            }
          }
          fetchTasks();
        }, []);

        return (
          <div
            style={{
              maxWidth: 425,
              margin: "0 auto",
              padding: 40,
              fontFamily: "sans-serif"
            }}
          >
            <h1>To-do list</h1>
            <div
              style={{
                width: 400,
                margin: "0 auto 16px auto",
                background: "#f0f0f0",
                borderRadius: 4,
                minHeight: 32,
                padding: 16,
                display: "flex",
                flexDirection: "column",
                alignItems: "stretch",
                justifyContent: "flex-start"
              }}
            >
              {loading ? (
                <span style={{ color: "#888", textAlign: "center" }}>
                  Loading...
                </span>
              ) : (
                <TaskList tasks={tasks} />
              )}
            </div>
          </div>
        );
      }

      createRoot(document.getElementById("root")).render(<App />);
    </script>
  </body>
</html>
